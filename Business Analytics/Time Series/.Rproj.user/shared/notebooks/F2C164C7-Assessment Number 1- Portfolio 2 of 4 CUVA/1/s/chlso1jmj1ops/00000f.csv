"0","# Function to clean Mileage by removing non-numeric characters"
"0","clean_mileage <- function(data) {"
"0","  data %>%"
"0","    mutate(Mileage = str_remove_all(Mileage, ""[^0-9]""),  # Remove all non-digits"
"0","           Mileage = as.numeric(Mileage))  # Convert to numeric"
"0","}"
"0",""
"0","# Function to split Fuel_Type and extract Engine_Size"
"0","split_fuel_engine <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Engine_Size = ifelse(str_detect(Fuel_Type, ""\\d\\.\\dL""),  # Check if Fuel_Type contains engine size (e.g., 2.0L)"
"0","                           str_extract(Fuel_Type, ""\\d\\.\\dL""),  # Extract engine size"
"0","                           ""0.0""),  # Default to 0.0 if not found"
"0","      Fuel = str_remove(Fuel_Type, ""\\d\\.\\dL\\s*""),  # Remove engine size from Fuel_Type"
"0","      Fuel = str_trim(Fuel)  # Trim whitespace"
"0","    )"
"0","}"
"0",""
"0","# Function to convert Engine_Size from liters to cubic centimeters (cc)"
"0","convert_engine_to_cc <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Engine_Size = as.numeric(str_remove(Engine_Size, ""L"")),  # Remove ""L"" and convert to numeric"
"0","      `Engine_Size (cc)` = Engine_Size * 1000  # Convert liters to cc"
"0","    ) %>%"
"0","    select(-Engine_Size)  # Drop the original Engine_Size column"
"0","}"
"0",""
"0","# Function to clean Price by removing currency symbols and commas"
"0","clean_price <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      `Price (£)` = as.numeric(str_remove_all(Price, ""[£,]""))  # Remove £ and commas, convert to numeric"
"0","    ) %>%"
"0","    select(-Price)  # Drop the original Price column"
"0","}"
"0",""
"0","# Function to extract Car Type from Make_Model using a predefined list"
"0","extract_car_type <- function(data) {"
"0","  car_types <- c(""Saloon"", ""Hatchback"", ""SUV"", ""Sports Utility Vehicle"","
"0","                 ""Crossover"", ""Coupe"", ""Coupé"", ""Convertible"", ""Cabriolet"","
"0","                 ""Estate"", ""Pick[- ]?up(?: Truck)?"", ""Minivan"", ""MPV"","
"0","                 ""Roadster"", ""Van"", ""Cargo Van"", ""City Car"", ""Microcar"","
"0","                 ""Liftback"", ""Fastback"", ""Targa(?: Top)?"", ""Limousine"","
"0","                 ""Supercar"", ""Hypercar"", ""4x4"", ""Off[- ]?Roader"", ""Muscle Car"","
"0","                 ""Coupe SUV"", ""Campervan"", ""Recreational Vehicle"", ""RV"","
"0","                 ""Sportback"", ""Panel Van"", ""Combi Van"", ""Touring"","
"0","                 ""Shooting Brake"", ""Double Cab"", ""Quad Cab"","
"0","                 ""Extended Cab"", ""Supercrew"", ""Hardtop"", ""Softtop"")"
"0","  "
"0","  car_type_pattern <- paste0(""(?i)("", paste(car_types, collapse = ""|""), "")"")  # Create regex pattern for car types"
"0","  "
"0","  data %>%"
"0","    mutate(`Car Type` = str_extract(Make_Model, car_type_pattern),  # Extract car type from Make_Model"
"0","           `Car Type` = str_to_title(str_trim(`Car Type`)))  # Capitalize and trim"
"0","}"
"0",""
"0","# Function to extract Car Brand from Make_Model using a predefined list"
"0","extract_car_brand <- function(data) {"
"0","  brands <- c(""Abarth"", ""AC"", ""Acura"", ""Aixam"", ""Alfa Romeo"", ""Alpine"", "
"0","              ""Aston Martin"", ""Audi"", ""Austin"", ""Bentley"", ""BMW"", ""Bugatti"", "
"0","              ""Buick"", ""Cadillac"", ""Caterham"", ""Chevrolet"", ""Chrysler"", "
"0","              ""Citroën"", ""Cupra"", ""Dacia"", ""Daewoo"", ""Daihatsu"", ""Dodge"", "
"0","              ""DS Automobiles"", ""Eagle"", ""Ferrari"", ""Fiat"", ""Fisker"", "
"0","              ""Ford"", ""Genesis"", ""GMC"", ""Great Wall"", ""Haval"", ""Holden"", "
"0","              ""Honda"", ""Hummer"", ""Hyundai"", ""Infiniti"", ""Isuzu"", ""Jaguar"", "
"0","              ""Jeep"", ""Kia"", ""Lada"", ""Lamborghini"", ""Lancia"", ""Land Rover"", "
"0","              ""Lexus"", ""Lincoln"", ""Lotus"", ""Mahindra"", ""Maserati"", ""Maybach"", "
"0","              ""Mazda"", ""McLaren"", ""Mercedes"", ""MG"", ""Mini"", ""Mitsubishi"", "
"0","              ""Nissan"", ""Oldsmobile"", ""Opel"", ""Pagani"", ""Peugeot"", ""Plymouth"", "
"0","              ""Polestar"", ""Pontiac"", ""Porsche"", ""Proton"", ""Ram"", ""Range Rover"", "
"0","              ""Renault"", ""Rolls-Royce"", ""Rover"", ""Saab"", ""Seat"", ""Skoda"", "
"0","              ""Smart"", ""SsangYong"", ""Subaru"", ""Suzuki"", ""Tata"", ""Tesla"", "
"0","              ""Toyota"", ""Vauxhall"", ""Volkswagen"", ""VW"", ""Volvo"", ""Wiesmann"", ""Zotye"")"
"0","  brands <- brands[order(nchar(brands), decreasing = TRUE)]  # Sort brands by length (longest first)"
"0","  "
"0","  data %>%"
"0","    mutate("
"0","      Car_brand = sapply(Make_Model, function(make_model) {  # Apply function to each Make_Model"
"0","        brand_found <- NA"
"0","        for (brand in brands) {  # Loop through brands"
"0","          if (str_starts(make_model, brand)) {  # Check if Make_Model starts with the brand"
"0","            brand_found <- brand"
"0","            break"
"0","          }"
"0","        }"
"0","        return(brand_found)  # Return the matched brand or NA"
"0","      }),"
"0","      Make_Model = str_trim(ifelse(is.na(Car_brand), Make_Model,  # Remove brand from Make_Model if found"
"0","                                   str_remove(Make_Model, paste0(""^"", Car_brand))))"
"0","    )"
"0","}"
"0",""
"0","# Function to extract Car Model from remaining Make_Model text"
"0","extract_car_model <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Car_model = if_else("
"0","        str_detect(Make_Model, ""\\s\\d\\.\\d""),  # Check for engine size pattern (e.g., ""2.0"")"
"0","        str_trim(str_extract(Make_Model, "".*?(?=\\s\\d\\.\\d)"")),  # Extract text before engine size"
"0","        str_trim(Make_Model)  # Otherwise use the full remaining text"
"0","      )"
"0","    )"
"0","}"
"0",""
"0","# Function to clean Year by extracting a 4-digit year"
"0","clean_year <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Year = case_when("
"0","        str_detect(Year, ""\\b\\d{4}\\b"") ~ str_extract(Year, ""\\b\\d{4}\\b""),  # Extract 4-digit year"
"0","        TRUE ~ NA_character_  # Return NA if no match"
"0","      )"
"0","    )"
"0","}"
"0",""
"0","# Function to further clean Car_model by removing unwanted terms"
"0","final_clean_car_model <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Car_model = str_split(Car_model, ""\\s+"") %>%  # Split into words"
"0","        lapply(function(words) {"
"0","          words_clean <- words[!str_detect(tolower(words), ""dr|kwh|kw|auto"")]  # Remove specific terms"
"0","          paste(words_clean, collapse = "" "")  # Rejoin words"
"0","        }) %>%"
"0","        unlist() %>%  # Convert back to vector"
"0","        str_squish()  # Remove extra whitespace"
"0","    )"
"0","}"
"0",""
"0","# Execute the cleaning pipeline for Autouncle data"
"0","auto_cars <- all_cars %>%"
"0","  clean_mileage() %>%              # Clean mileage values"
"0","  split_fuel_engine() %>%          # Split fuel and engine size"
"0","  convert_engine_to_cc() %>%       # Convert engine size to cc"
"0","  clean_price() %>%                # Clean price values"
"0","  extract_car_type() %>%           # Extract car type"
"0","  extract_car_brand() %>%          # Extract car brand"
"0","  extract_car_model() %>%          # Extract car model"
"0","  clean_year() %>%                 # Clean year values"
"0","  final_clean_car_model() %>%      # Final cleanup of car model"
"0","  select(-Make_Model, -Fuel_Type, -Power)  # Drop unnecessary columns"
"0",""
"0","View(auto_cars)  # Display the cleaned Autouncle data"
