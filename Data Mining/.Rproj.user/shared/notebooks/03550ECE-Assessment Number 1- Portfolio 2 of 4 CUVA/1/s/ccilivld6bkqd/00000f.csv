"0","clean_mileage <- function(data) {"
"0","  data %>%"
"0","    mutate(Mileage = str_remove_all(Mileage, ""[^0-9]""),"
"0","           Mileage = as.numeric(Mileage))"
"0","}"
"0",""
"0","split_fuel_engine <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Engine_Size = ifelse(str_detect(Fuel_Type, ""\\d\\.\\dL""),"
"0","                           str_extract(Fuel_Type, ""\\d\\.\\dL""),"
"0","                           ""0.0""),"
"0","      Fuel = str_remove(Fuel_Type, ""\\d\\.\\dL\\s*""),"
"0","      Fuel = str_trim(Fuel)"
"0","    )"
"0","}"
"0",""
"0","convert_engine_to_cc <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Engine_Size = as.numeric(str_remove(Engine_Size, ""L"")),"
"0","      `Engine_Size (cc)` = Engine_Size * 1000"
"0","    ) %>%"
"0","    select(-Engine_Size)"
"0","}"
"0",""
"0","clean_price <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      `Price (£)` = as.numeric(str_remove_all(Price, ""[£,]""))"
"0","    ) %>%"
"0","    select(-Price)"
"0","}"
"0",""
"0","extract_car_type <- function(data) {"
"0","  car_types <- c(""Saloon"", ""Hatchback"", ""SUV"", ""Sports Utility Vehicle"","
"0","                 ""Crossover"", ""Coupe"", ""Coupé"", ""Convertible"", ""Cabriolet"","
"0","                 ""Estate"", ""Pick[- ]?up(?: Truck)?"", ""Minivan"", ""MPV"","
"0","                 ""Roadster"", ""Van"", ""Cargo Van"", ""City Car"", ""Microcar"","
"0","                 ""Liftback"", ""Fastback"", ""Targa(?: Top)?"", ""Limousine"","
"0","                 ""Supercar"", ""Hypercar"", ""4x4"", ""Off[- ]?Roader"", ""Muscle Car"","
"0","                 ""Coupe SUV"", ""Campervan"", ""Recreational Vehicle"", ""RV"","
"0","                 ""Sportback"", ""Panel Van"", ""Combi Van"", ""Touring"","
"0","                 ""Shooting Brake"", ""Double Cab"", ""Quad Cab"","
"0","                 ""Extended Cab"", ""Supercrew"", ""Hardtop"", ""Softtop"")"
"0","  "
"0","  car_type_pattern <- paste0(""(?i)("", paste(car_types, collapse = ""|""), "")"")"
"0","  "
"0","  data %>%"
"0","    mutate(`Car Type` = str_extract(Make_Model, car_type_pattern),"
"0","           `Car Type` = str_to_title(str_trim(`Car Type`)))"
"0","}"
"0",""
"0","extract_car_brand <- function(data) {"
"0","  brands <- c(""Abarth"", ""AC"", ""Acura"", ""Aixam"", ""Alfa Romeo"", ""Alpine"", "
"0","              ""Aston Martin"", ""Audi"", ""Austin"", ""Bentley"", ""BMW"", ""Bugatti"", "
"0","              ""Buick"", ""Cadillac"", ""Caterham"", ""Chevrolet"", ""Chrysler"", "
"0","              ""Citroën"", ""Cupra"", ""Dacia"", ""Daewoo"", ""Daihatsu"", ""Dodge"", "
"0","              ""DS Automobiles"", ""Eagle"", ""Ferrari"", ""Fiat"", ""Fisker"", "
"0","              ""Ford"", ""Genesis"", ""GMC"", ""Great Wall"", ""Haval"", ""Holden"", "
"0","              ""Honda"", ""Hummer"", ""Hyundai"", ""Infiniti"", ""Isuzu"", ""Jaguar"", "
"0","              ""Jeep"", ""Kia"", ""Lada"", ""Lamborghini"", ""Lancia"", ""Land Rover"", "
"0","              ""Lexus"", ""Lincoln"", ""Lotus"", ""Mahindra"", ""Maserati"", ""Maybach"", "
"0","              ""Mazda"", ""McLaren"", ""Mercedes"", ""MG"", ""Mini"", ""Mitsubishi"", "
"0","              ""Nissan"", ""Oldsmobile"", ""Opel"", ""Pagani"", ""Peugeot"", ""Plymouth"", "
"0","              ""Polestar"", ""Pontiac"", ""Porsche"", ""Proton"", ""Ram"", ""Range Rover"", "
"0","              ""Renault"", ""Rolls-Royce"", ""Rover"", ""Saab"", ""Seat"", ""Skoda"", "
"0","              ""Smart"", ""SsangYong"", ""Subaru"", ""Suzuki"", ""Tata"", ""Tesla"", "
"0","              ""Toyota"", ""Vauxhall"", ""Volkswagen"", ""VW"", ""Volvo"", ""Wiesmann"", ""Zotye"")"
"0","  brands <- brands[order(nchar(brands), decreasing = TRUE)]"
"0","  "
"0","  data %>%"
"0","    mutate("
"0","      Car_brand = sapply(Make_Model, function(make_model) {"
"0","        brand_found <- NA"
"0","        for (brand in brands) {"
"0","          if (str_starts(make_model, brand)) {"
"0","            brand_found <- brand"
"0","            break"
"0","          }"
"0","        }"
"0","        return(brand_found)"
"0","      }),"
"0","      Make_Model = str_trim(ifelse(is.na(Car_brand), Make_Model,"
"0","                                   str_remove(Make_Model, paste0(""^"", Car_brand))))"
"0","    )"
"0","}"
"0",""
"0","extract_car_model <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Car_model = if_else("
"0","        str_detect(Make_Model, ""\\s\\d\\.\\d""),"
"0","        str_trim(str_extract(Make_Model, "".*?(?=\\s\\d\\.\\d)"")),"
"0","        str_trim(Make_Model)"
"0","      )"
"0","    )"
"0","}"
"0",""
"0","clean_year <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Year = case_when("
"0","        str_detect(Year, ""\\b\\d{4}\\b"") ~ str_extract(Year, ""\\b\\d{4}\\b""),"
"0","        TRUE ~ NA_character_"
"0","      )"
"0","    )"
"0","}"
"0",""
"0","final_clean_car_model <- function(data) {"
"0","  data %>%"
"0","    mutate("
"0","      Car_model = str_split(Car_model, ""\\s+"") %>% "
"0","        lapply(function(words) {"
"0","          words_clean <- words[!str_detect(tolower(words), ""dr|kwh|kw|auto"")]"
"0","          paste(words_clean, collapse = "" "")"
"0","        }) %>%"
"0","        unlist() %>%"
"0","        str_squish()"
"0","    )"
"0","}"
"0",""
"0","# Auto Uncle Pipeline Execution"
"0","auto_cars <- all_cars %>%"
"0","  clean_mileage() %>%"
"0","  split_fuel_engine() %>%"
"0","  convert_engine_to_cc() %>%"
"0","  clean_price() %>%"
"0","  extract_car_type() %>%"
"0","  extract_car_brand() %>%"
"0","  extract_car_model() %>%"
"0","  clean_year() %>%"
"0","  final_clean_car_model() %>%"
"0","  select(-Make_Model, -Fuel_Type, -Power)"
"0",""
"0","View(auto_cars)"
